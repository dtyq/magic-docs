# 消息回复节点

## 什么是消息回复节点？
消息回复节点是一个用于向用户发送信息的基础节点，当消息回复节点与大模型节点配合使用时，还可以实现流式回复效果，它支持多种消息类型，包括纯文本、Markdown格式文本以及各类附件（图片、音频、视频、文件），让您可以灵活地与用户进行信息交流。

**图片说明：**

消息回复节点界面主要由消息类型选择区和内容编辑区组成。顶部可以选择要发送的消息类型（文本、Markdown、图片等），下方的内容编辑区会根据所选类型显示相应的配置选项，如文本编辑框或附件链接输入框等。您可以在这里配置要发送给用户的具体内容。

![消息回复节点](https://cdn.letsmagic.cn/static/img/reply-node-1.png)

![消息回复节点类型](https://cdn.letsmagic.cn/static/img/reply-node-2.png)

![消息回复节点类型](https://cdn.letsmagic.cn/static/img/reply-node-3.png)

## 为什么需要消息回复节点？
在构建智能工作流时，消息回复节点解决了以下关键问题：
1. **信息传递**：将工作流处理的结果、状态或提示信息传达给用户，保持交互的连续性。
2. **多样化表达**：通过支持多种消息类型（文本、Markdown、附件等），使回复内容更加丰富多样，提升用户体验。
3. **结构化展示**：利用Markdown格式可以创建表格、列表、粗体、斜体等富文本效果，使信息更有条理，易于理解。
4. **专业内容分享**：通过附件功能分享图片、文档等专业内容，满足复杂业务场景的需求。

## 适用场景
### 1. 用户问答回复
当用户向AI 助理提出问题后，消息回复节点可以发送准确、详细的文本回答，提供用户所需的信息。这是最基础也是最常见的应用场景。
### 2. 结构化数据展示
当需要向用户展示表格、列表等结构化数据时，可以使用Markdown格式编写内容，如展示查询结果、商品列表、任务清单等。
### 3. 文件资料分享
当用户需要获取图片、文档等文件资料时，可以通过附件形式发送，如分享产品说明书、技术手册、表格报表等。

## 节点参数说明
### 基本参数
|参数名称|描述|数据类型|是否必填|默认值|
|---|---|---|---|---|
|消息类型|指定要发送的消息类型|选择器|是|文本(Text)|
|内容|消息的具体文本内容|字符串|根据消息类型决定|无|
|附件链接|附件的访问链接|字符串|附件类型时必填|无|
|附件名称|附件的显示名称|字符串|附件类型时必填|无|

### 消息类型说明
消息回复节点支持以下几种消息类型：
1. **文本(Text)**：纯文本消息，适合简单的文字回复
2. **Markdown**：支持格式化的文本，可以使用标题、列表、表格等样式
3. **图片(Image)**：发送图片附件
4. **视频(Video)**：发送视频附件
5. **音频(Audio)**：发送音频附件
6. **文件(File)**：发送通用文件附件

### 输入说明
消息回复节点的输入主要来自于工作流中前置节点的处理结果：
1. **变量引用**：可以在内容字段中使用`${变量名}`格式引用工作流中的变量
2. **动态内容**：支持引用大模型调用结果、条件判断结果等动态内容
3. **附件路径**：可以引用文档解析节点、HTTP请求节点等产生的附件路径

### 输出说明
消息回复节点没有标准的输出内容，取决于节点上设置的消息类型

## 使用说明
### 基本配置步骤
1. **添加消息回复节点**：
    1. 从节点面板拖拽"消息回复"节点到工作流画布
    2. 将该节点连接到前一个节点（如条件分支、大模型调用等）
2. **选择消息类型**：
    1. 在右侧配置面板中选择需要发送的消息类型
    2. 文本：用于发送简单的文字消息
    3. Markdown：用于发送带格式的文本，支持标题、列表、表格等
    4. 图片/视频/音频/文件：用于发送对应类型的附件
3. **配置消息内容**：
    1. 文本/Markdown类型：直接在编辑框中输入内容
    2. 附件类型：填写附件链接和显示名称
    3. 可以使用变量引用：`${变量名}`
4. **设置流式输出**（可选）：
    1. 配合大模型调用节点时，可以打开流式输出功能
    2. 流式输出可以实现打字机效果，逐字显示内容

### 高级技巧
#### Markdown格式化技巧
Markdown支持丰富的格式化功能，常用的有：
1. **标题**：使用`#`号表示，例如：
```markdown
# 一级标题
## 二级标题
### 三级标题
```
2. **列表**：使用`-`或`1.`表示，例如：
```markdown
- 无序列表项1
- 无序列表项2

1. 有序列表项1
2. 有序列表项2
```
3. **表格**：使用`|`和`-`构建，例如：
```markdown
|名称|价格|
|---|---|
|商品A|¥100|
|商品B|¥200|
```
4. **文本样式**：使用`*`或`**`表示，例如：
```markdown
*斜体文本*
**粗体文本**
```

#### 动态内容构建
1. **组合多个变量**：将多个变量组合成一个消息
```
用户信息：
姓名：${user_name}
年龄：${user_age}
偏好：${user_preference}
```
2. **条件性内容**：在前置节点中处理条件逻辑，为消息回复节点提供已处理的内容

#### 附件类型使用技巧
1. **动态附件路径**：使用变量引用动态生成的文件路径
```
附件链接：${file_url}
附件名称：${file_name}
```
2. **多媒体内容展示**：根据不同场景选择不同的附件类型，增强用户体验
3. **下载文件提示**：在发送文件附件时，可以添加文件大小、类型等提示信息

## 注意事项
### 内容长度限制
1. **文本长度**：一般消息平台对单条消息有字符数限制，过长内容可能会被截断
2. **附件大小**：各类附件通常有大小限制，超出限制的附件可能无法发送
3. **分段策略**：对于长文本内容，考虑拆分为多条消息发送

### 格式兼容性
1. **Markdown兼容性**：不同平台对Markdown格式的支持程度可能不同，测试关键格式
2. **附件格式**：确保附件格式被目标平台支持，常见格式如JPG、PNG、PDF等通常都支持
3. **显示效果**：同样的内容在不同设备上的显示效果可能略有差异，注意设计的普适性

### 响应时间
1. **消息发送时机**：合理安排消息发送顺序和时机，避免信息爆炸
2. **大型附件**：发送大型附件可能需要较长处理时间，考虑添加等待提示
3. **流式输出**：使用流式输出能够提升用户体验，但要注意内容的连贯性

## 常见问题
### 问题1：消息未能成功发送给用户
**解决方案**：
1. 检查节点连接是否正确，确保消息回复节点被前序节点触发
2. 确认消息内容不为空，且符合格式要求
3. 如使用变量引用，检查变量是否存在且有值
4. 验证附件链接是否有效且可访问

### 问题2：Markdown格式未正确显示
**解决方案**：
1. 检查Markdown语法是否正确，注意各标记符号前后的空格
2. 确认目标平台支持您使用的Markdown特性
3. 尝试使用基础Markdown语法，避免使用高级或非标准特性
4. 对于关键格式，可以在实际环境中进行测试验证

### 问题3：如何实现分步骤回复内容？
**解决方案**：
1. 使用多个消息回复节点，通过顺序连接实现分步发送
2. 在节点之间可以添加延时节点，控制消息发送的时间间隔
3. 对于流式回复，可以在前置的大模型调用中控制内容的结构和分段
4. 使用等待节点可以实现与用户的交互式分步回复

## 常见配对节点
|节点类型|配对原因|
|---|---|
|大模型调用节点|生成智能回复内容，由消息回复节点展示给用户|
|条件分支节点|根据不同条件，提供不同的回复内容|
|文档解析节点|解析文档后，展示处理结果|
|HTTP请求节点|获取外部数据后，格式化展示给用户|
|等待节点|发送问题或提示后，等待用户回复|