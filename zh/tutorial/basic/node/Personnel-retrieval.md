# 人员检索节点
## 什么是人员检索节点？
人员检索节点是Magic Flow工作流中专门用于查询和筛选组织内部人员信息的功能节点。它允许您根据多种条件（如姓名、工号、岗位、部门等）快速定位并获取人员数据，就像是在企业通讯录中进行精准搜索一样。

**图片说明：**

人员检索节点界面主要由检索条件设置区域和输出数据结构预览区域组成。上部显示各类过滤条件配置选项，包括用户姓名、工号、岗位等筛选条件；下部展示了查询结果的数据结构，包含用户基本信息和部门信息等字段。
![知识检索节点](/static/img/Personnel-retrieval.png)

## 为什么需要人员检索节点？
在企业工作流中，精准获取人员信息是许多自动化流程的基础需求：
- **数据关联**：将业务数据与具体负责人或团队关联起来
- **权限控制**：根据人员角色或部门划分信息访问权限
- **流程流转**：识别下一步流程的处理人或审批人
- **消息通知**：向特定人员或团队发送自动化通知
- **团队协作**：搭建基于组织架构的智能协作流程
## 适用场景
### 1. 智能审批流程
根据申请内容自动查找对应部门的审批人，将审批请求精准转发，提高流程效率。
### 2. 部门信息汇总
快速检索特定部门的全部成员信息，用于生成部门报表、团队分析或资源分配。
### 3. 人员数据联动
在用户提交请求时，根据其身份信息自动关联其所在部门、直属领导等信息，减少手动填写。
### 4. 消息智能分发
根据业务规则自动查找相关负责人，将系统消息或工作提醒精准发送到合适的人手中。
## 节点参数说明
### 检索条件参数
|参数名称|说明|是否必填|默认值|
|---|---|---|---|
|用户姓名|按人员真实姓名进行匹配|否|无|
|用户工号|按人员工号进行匹配|否|无|
|用户岗位|按人员职位或岗位名称进行匹配|否|无|
|用户手机号|按人员手机号码进行匹配|否|无|
|部门名称|按部门名称进行匹配|否|无|
|群聊名称|按群聊名称进行匹配|否|无|

### 条件规则说明
每个检索条件支持以下规则类型：
|规则类型|说明|示例|
|---|---|---|
|等于|字段值完全匹配指定值|姓名等于"张三"|
|不等于|字段值不等于指定值|岗位不等于"实习生"|
|包含|字段值包含指定内容|部门名称包含"技术"|
|不包含|字段值不包含指定内容|姓名不包含"测试"|
|为空|字段值为空值|手机号为空|
|不为空|字段值不为空|工号不为空|

### 值类型设置
|值类型|说明|示例|
|---|---|---|
|固定值|直接输入具体的查询值|"张三"、"研发部"|
|变量值|引用工作流中的变量作为查询值|department_name|

### 输出内容
|输出字段|说明|
|---|---|
|用户数据 (Array)|匹配条件的用户列表，每个用户包含以下字段:用户唯一标识ID、用户真实姓名、用户岗位名称、等信息|

## 使用说明
### 基本配置步骤
1. **设置基本检索条件**：
    1. 点击需要使用的检索条件（如"用户姓名"）
    2. 选择匹配规则（如"等于"、"包含"等）
    3. 选择值类型（"固定值"或"变量值"）
    4. 输入具体的查询值或选择变量
2. **添加多个检索条件**（可选）：
    1. 点击"添加条件"按钮添加更多过滤条件
    2. 多个条件之间默认为"与"(AND)关系，即同时满足所有条件
3. **查看输出字段**：
    1. 展开"输出"部分，了解查询结果的数据结构
    2. 熟悉各字段含义，以便在后续节点中正确引用
4. **连接后续节点**：
    1. 将人员检索节点的输出连接到需要使用人员信息的节点
    2. 在后续节点中使用`节点名.用户数据`引用检索结果
## 注意事项
### 检索效率
当组织人员规模较大时，注意检索条件的设置影响效率：
- 尽量使用精确的条件（如工号、手机号）而非模糊条件（如姓名包含）
- 合理组合多个条件，缩小检索范围
- 避免不必要的全量查询，以减少系统负担
### 数据权限
人员检索会受到当前Bot账号的权限限制：
- 只能检索到Bot有权限访问的部门和人员
- 某些敏感信息（如手机号）可能需要特定权限才能获取
- 确保Bot账号具有足够的组织架构访问权限
### 数据时效性
人员信息可能存在变动，需要注意：
- 检索结果反映的是当前时刻的组织架构状态
- 人员岗位变动、离职等情况需要有应对策略
- 关键流程建议加入结果验证逻辑
## 常见问题
### 问题1：检索条件设置了但没有返回预期结果怎么办？
**解决方案**：可能是条件设置不匹配或权限问题。建议：
- 检查条件值是否正确，特别是变量引用
- 确认比较运算符使用正确（如"等于"vs"包含"）
- 尝试放宽条件或使用更精确的条件（如工号）
- 检查Bot账号是否有权限访问目标人员信息
### 问题2：如何处理同名用户的情况？
**解决方案**：同名用户在大型组织中较为常见：
- 组合使用多个条件（如姓名+部门）进行过滤
- 优先使用唯一标识（如工号或用户ID）进行检索
- 在结果处理时增加同名判断逻辑（如通过部门区分）
### 问题3：检索的结果数量有上限吗？
**解决方案**：是的，通常有返回数量限制：
- 默认最多返回50条匹配记录
- 如需查询大量用户，建议分批次进行或优化检索条件
- 对于全部门查询等大范围场景，考虑使用更专业的报表工具
## 常见搭配节点
|节点类型|搭配原因|
|---|---|
|消息回复节点|将检索到的人员信息展示给用户|
|条件分支节点|根据检索结果是否存在决定后续流程|
|大模型调用节点|利用人员信息构建个性化回复或分析|
|创建群聊节点|基于检索结果自动创建特定群聊|
|HTTP请求节点|将人员信息发送给外部系统进行处理|