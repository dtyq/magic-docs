# 变量保存节点
## 什么是变量保存节点？
变量保存节点是Magic工作流中的一个基础数据处理节点，用于在工作流中创建、设置或更新变量。这个节点可以帮助您在流程中存储临时数据，供后续节点使用，实现数据在不同节点间的传递和共享。

**图片说明：**

变量保存节点界面由左侧的变量基本信息设置区和右侧的变量值配置区组成。在这里可以设置变量名、显示名称、选择变量类型，并为变量赋予具体的值。
![变量保存节点](/static/img/Variable-saving.png)

## 为什么需要变量保存节点？
在构建工作流时，我们常常需要临时存储一些数据，比如用户的输入、计算的结果或者中间状态等，以便在工作流的不同阶段使用。变量保存节点就是为了满足这一需求而设计的。它可以：
- 创建新变量或更新已有变量的值
- 支持多种数据类型，满足不同的存储需求
- 为工作流的其他节点提供数据支持
- 实现工作流中的数据传递和共享
## 适用场景
### 场景一：存储用户输入
当您需要记录用户在对话中提供的信息（如姓名、年龄、偏好等）时，可以使用变量保存节点将这些信息保存下来，以便在后续节点中使用。
### 场景二：保存中间计算结果
在复杂工作流中，您可能需要进行多步骤的数据处理。变量保存节点可以帮助您存储每个步骤的计算结果，避免重复计算。
### 场景三：动态控制工作流走向
您可以使用变量保存节点来存储标志位或状态值，然后在条件分支节点中根据这些变量的值来决定工作流的执行路径。
## 节点参数说明
变量保存节点的参数主要分为两部分：变量基本信息和变量值设置。
### 变量基本信息
|参数名称|说明|是否必填|示例值|
|---|---|---|---|
|变量名|变量的唯一标识符，只能包含字母、数字和下划线，用于在代码或其他节点中引用该变量|是|user_name|
|显示名称|变量的易读名称，方便在工作流中识别变量的用途|否|用户姓名|
|变量类型|变量的数据类型，决定了变量可以存储的数据种类|是|字符串|
|变量值|要设置的变量值，可以是固定值或从其他节点输出中获取|是|固定值|

### 变量类型选项
**变量保存节点支持以下几种常见的变量类型：**
1. **字符串** - 用于存储文本内容
2. **数字** - 用于存储整数或小数
3. **布尔值** - 用于存储是/否、真/假的二元值
4. **数组** - 用于存储多个值的集合
5. **对象** - 用于存储包含多个键值对的复杂数据结构
### 变量值设置
**根据选择的变量类型，变量值的设置方式会有所不同：**
- **字符串**：可以直接输入文本，也可以引用其他变量
- **数字**：输入数字值或数学表达式
- **布尔值**：选择"真"或"假"
- **数组**：添加多个元素，每个元素可以是不同类型
- **对象**：添加多个键值对，指定每个属性的键名和值
## 使用说明
### 基本配置步骤
1. **添加节点**：在工作流编辑器中，从左侧节点面板找到"变量保存"节点，拖入到工作流画布中的合适位置。
2. **设置变量名**：在右侧属性面板中，为变量指定一个有意义的名称，建议使用小写字母加下划线的命名方式，如 `user_age`。
3. **添加显示名称**（可选）：输入一个便于理解的中文名称，如"用户年龄"。
4. **选择变量类型**：根据需要存储的数据类型，从下拉菜单中选择合适的变量类型。
5. **设置变量值**：
    1. 对于**固定值**：直接在输入框中输入具体的值
    2. 对于**引用其他变量**：点击"花括号"图标，从弹出的变量列表中选择需要引用的变量
    3. 对于**复杂类型**（如数组或对象）：点击"添加参数"按钮增加元素或属性
6. **连接节点**：将变量保存节点与工作流中的其他节点通过连线连接起来，确保工作流能够正确流转。
### 高级使用技巧
#### 技巧一：引用其他变量
变量值不仅可以是固定的，还可以引用其他已定义的变量。通过在值输入框中使用 `{{变量名}}` 的语法，可以动态获取其他变量的值。
#### 技巧二：使用表达式
对于数字类型的变量，可以使用简单的数学表达式作为变量值，例如 `{{num1}} + {{num2}} * 2`。
#### 技巧三：条件赋值
结合代码执行节点，可以实现根据条件为变量赋不同的值。
## 注意事项
### 变量命名规范
- 变量名只能包含字母、数字和下划线
- 变量名不能以数字开头
- 变量名区分大小写
- 避免使用系统保留关键字作为变量名
### 变量值更新机制
- 如果工作流中已存在同名变量，变量保存节点会覆盖原有值
- 如果引用的变量不存在，可能会导致工作流执行错误
- 更新复杂类型变量（如数组、对象）时，会完全替换原有值，而非部分更新
### 作用域限制
- 变量的作用域限于当前工作流，子流程需要通过参数传递才能访问父流程的变量
- 变量在工作流执行结束后会被清除，如需持久化存储，请使用数据存储节点
## 常见问题
### 问题一：我设置的变量为什么在其他节点中无法使用？
**解决方案**：可能有以下几个原因：
- 变量名输入错误或大小写不匹配
- 变量保存节点未被执行（例如位于条件分支中且条件未满足）
- 变量引用语法不正确，正确的引用方式是使用双花括号：`{{变量名}}`
### 问题二：如何在变量保存节点中存储复杂的JSON数据？
**解决方案**：

选择"对象"类型，然后通过添加多个键值对来构建JSON结构。对于嵌套结构，可以在子属性中再次选择"对象"类型。或者，使用代码执行节点处理复杂JSON，再将结果赋值给变量。
### 问题三：变量类型选择错误怎么办？
**解决方案**：

您可以随时调整变量类型，但这会重置变量值的设置。建议先仔细考虑变量的用途和可能的值，然后再选择合适的类型。
## 常见搭配节点
|**节点类型**|**搭配原因**|
|---|---|
|条件分支节点|存储判断条件的变量，用于控制工作流的执行路径|
|代码执行节点|存储代码计算的结果|
|HTTP请求节点|通过API和内外部系统进行数据交互|
|大模型调用节点|存储大模型生成的内容|