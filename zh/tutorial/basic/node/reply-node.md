# 消息回复节点

## 什么是消息回复节点？
消息回复节点是一个用于向用户发送信息的基础节点，当消息回复节点与大模型节点配合使用时，还可以实现流式回复效果，它支持多种消息类型，包括纯文本、Markdown格式文本以及各类附件（图片、音频、视频、文件），让您可以灵活地与用户进行信息交流。

**图片说明：**

消息回复节点界面主要由消息类型选择区和内容编辑区组成。顶部可以选择要发送的消息类型（文本、Markdown、图片等），下方的内容编辑区会根据所选类型显示相应的配置选项，如文本编辑框或附件链接输入框等。您可以在这里配置要发送给用户的具体内容。

![消息回复节点](/static/img/reply-node-1.png)

![消息回复节点类型](/static/img/reply-node-2.png)

![消息回复节点类型](/static/img/reply-node-3.png)

## 为什么需要消息回复节点？
在构建智能工作流时，消息回复节点解决了以下关键问题：
1. **信息传递**：将工作流处理的结果、状态或提示信息传达给用户，保持交互的连续性。
2. **多样化表达**：通过支持多种消息类型（文本、Markdown、附件等），使回复内容更加丰富多样，提升用户体验。
3. **结构化展示**：利用Markdown格式可以创建表格、列表、粗体、斜体等富文本效果，使信息更有条理，易于理解。
4. **专业内容分享**：通过附件功能分享图片、文档等专业内容，满足复杂业务场景的需求。
## 适用场景
### 1. 用户问答回复
当用户向AI 助理提出问题后，消息回复节点可以发送准确、详细的文本回答，提供用户所需的信息。这是最基础也是最常见的应用场景。
### 2. 结构化数据展示
当需要向用户展示表格、列表等结构化数据时，可以使用Markdown格式编写内容，如展示查询结果、商品列表、任务清单等。
### 3. 文件资料分享
当用户需要获取图片、文档等文件资料时，可以通过附件形式发送，如分享产品说明书、技术手册、表格报表等。
## 节点参数说明
### 基本参数
|参数名称|描述|数据类型|是否必填|默认值|
|---|---|---|---|---|
|消息类型|指定要发送的消息类型|选择器|是|文本(Text)|
|内容|消息的具体文本内容|字符串|根据消息类型决定|无|
|附件链接|附件的访问链接|字符串|附件类型时必填|无|
|附件名称|附件的显示名称|字符串|附件类型时必填|无|

### 消息类型说明
消息回复节点支持以下几种消息类型：
1. **文本(Text)**：纯文本消息，适合简单的文字回复
2. **Markdown**：支持格式化的文本，可以使用标题、列表、表格等样式
3. **图片(Image)**：发送图片附件
4. **视频(Video)**：发送视频附件
5. **音频(Audio)**：发送音频附件
6. **文件(File)**：发送通用文件附件
### 输入说明
消息回复节点的输入主要来自于工作流中前置节点的处理结果：
1. **变量引用**：可以在内容字段中使用`${变量名}`格式引用工作流中的变量
2. **动态内容**：支持引用大模型调用结果、条件判断结果等动态内容
3. **附件路径**：可以引用文档解析节点、HTTP请求节点等产生的附件路径
### 输出说明
消息回复节点没有标准的输出内容，取决于节点上设置的消息类型
## 使用说明
### 基本配置步骤
1. **添加消息回复节点**：
    1. 从节点面板中拖拽"消息回复"节点到画布上
    2. 将前置节点与消息回复节点连接起来
2. **选择消息类型**：
    1. 点击节点，在右侧属性面板中选择需要发送的消息类型
    2. 根据业务需求选择合适的类型（文本、Markdown、图片等）
3. **配置消息内容**：
    1. 对于文本和Markdown类型：在"内容"字段中输入要发送的文本
    2. 对于附件类型（图片、音频、视频、文件）：
        1. 在"附件链接"字段中输入附件的URL地址
        2. 在"附件名称"字段中输入附件的显示名称
4. **使用变量引用**：
    1. 在内容字段中使用`${变量名}`格式引用工作流中的变量
    2. 例如：`您好，${user_name}！您的查询结果是：${query_result}`
5. **保存并连接后续节点**：
    1. 保存配置，并根据需要连接到下一个节点
    2. 如果是流程的最后一个步骤，可以连接到结束节点
### 进阶技巧
#### Markdown格式技巧
使用Markdown格式可以让您的消息更加结构化和美观：
1. **标题层级**：使用`#`、`##`、`###`等创建不同级别的标题
2. **列表格式**：使用`-`或`1.`创建无序或有序列表
3. **表格创建**：使用`|`和`-`组合创建表格结构
4. **文本强调**：使用`**文字**`加粗或`*文字*`斜体
5. **链接插入**：使用`[链接文字](URL地址)`格式插入链接
示例Markdown内容：
```
## 查询结果

您的查询结果如下：

| 项目 | 状态 | 完成度 |
|-----|------|-------|
| 任务A | 进行中 | 75% |
| 任务B | 已完成 | 100% |

请点击[这里](https://example.com)查看详细报告。
```
#### 动态内容生成
结合其他节点，可以生成更加动态和个性化的回复内容：
1. **结合大模型调用**：引用大模型生成的内容，提供智能化回复
2. **结合条件分支**：根据不同条件动态决定回复内容
3. **结合代码执行**：使用代码处理数据后生成格式化内容
4. **结合HTTP请求**：展示从外部API获取的数据
## 注意事项
### 内容长度限制
1. **文本长度**：单条消息的文本内容不宜过长，建议控制在5000字符以内
2. **分段发送**：对于超长内容，考虑使用多个消息回复节点分段发送
3. **避免刷屏**：不要在短时间内连续发送大量消息，可能导致用户体验不佳
### 附件使用规范
1. **文件大小**：附件大小要适中，过大的文件可能导致加载缓慢
2. **链接有效性**：确保附件链接是有效的，且有足够的访问权限
3. **文件格式**：确保发送的文件格式是常见的、易于打开的格式
4. **命名规范**：附件名称应简洁明了，表达文件内容
### 变量引用注意事项
1. **变量存在性**：确保引用的变量在工作流中已定义并有值
2. **变量类型**：注意变量的数据类型，非字符串类型可能需要转换
3. **空值处理**：考虑变量可能为空的情况，必要时设置默认值
4. **转义字符**：如需在文本中显示`${}`字符，请使用反斜杠转义
## 常见问题
### 为什么我的Markdown格式没有正确显示？
1. **语法错误**：检查Markdown语法是否正确，特别是表格、列表等结构
2. **客户端支持**：确认目标客户端是否完全支持Markdown格式
3. **特殊字符**：某些特殊字符可能需要转义，如`*`、`_`、`#`等
4. **空行处理**：确保段落之间有空行，列表项之间没有空行
### 如何在回复中插入动态生成的图片？
1. **使用HTTP请求节点**：获取或生成图片，得到图片URL
2. **使用变量存储URL**：将图片URL存储在变量中
3. **切换到图片类型**：在消息回复节点中选择"图片"类型
4. **引用URL变量**：在附件链接字段中引用存储URL的变量
### 如何处理消息发送失败的情况？
1. **添加错误处理**：在消息回复节点后添加条件分支检查发送状态
2. **设置重试机制**：对于重要消息，考虑添加重试逻辑
3. **记录错误日志**：使用代码执行节点记录失败原因
4. **备选通知渠道**：配置备选的通知方式，确保信息能够传达