# 数据存储节点
## 什么是数据存储节点？
数据存储节点是麦吉平台中用于将关键信息持久化保存的功能组件。它就像一个可靠的笔记本，能够记录下工作流中的重要数据，并在需要时随时查阅使用，即使在对话结束后依然保留这些信息。

**图片说明：**

数据存储节点界面主要包含作用域选择区、数据键输入区、数据值编辑区和过期时间设置区四个主要部分，通过这些区域的配置，用户可以指定要保存的数据及其存储方式。
![数据存储节点](/static/img/Data-storage.png)

## 为什么需要数据存储节点？
在智能体使用过程中，我们经常需要记住一些重要信息以便后续使用，例如：
1. **跨会话记忆**：用户的偏好设置、历史互动记录等需要长期保存
2. **数据持久化**：将临时生成的重要数据（如分析结果、用户输入的关键信息）保存起来
3. **状态管理**：记录工作流的执行状态，支持复杂业务流程的断点续传
4. **共享信息**：在不同的智能体或工作流之间共享数据
数据存储节点就像是智能体的"长期记忆"，让智能体具备了"过目不忘"的能力，极大提升了用户体验和智能体的实用性。
## 适用场景
### 场景一：用户信息记忆
记住用户的姓名、偏好等个人信息，在后续交互中直接调用，无需重复询问，提供个性化服务。
### 场景二：多轮对话上下文保存
在复杂问题解决过程中，保存中间结果或讨论要点，即使对话中断后重新开始，也能快速回到之前的讨论状态。
### 场景三：业务状态跟踪
在办理业务流程中，记录用户当前处理到哪一步，以便下次继续办理时无需重头开始。
## 节点参数说明
### 输入说明
|参数名称|说明|是否必填|
|---|---|---|
|作用域|选择数据的存储范围，决定谁可以访问这些数据。默认选项通常是"当前话题"。|是|
|数据键|用于标识存储的数据，相当于数据的"名字"，便于后续查找和使用。支持使用"@"引用变量。|是|
|数据值|需要存储的具体内容，可以是文本、数字或其他格式的数据。支持使用"@"引用变量。|是|
|过期时间（秒）|设置数据的有效期，超过该时间后数据将被自动删除。不填则表示永不过期。支持使用"@"引用变量。|否|

### 输出说明
数据存储节点会将指定的数据保存到持久化存储中，但不直接生成输出变量。保存成功后，可通过"数据加载节点"使用相同的键名来检索已保存的数据。
## 使用说明
### 基本配置步骤
1. **添加数据存储节点**：在工作流编辑器中，将数据存储节点拖入画布。
2. **配置作用域**：选择适合的作用域，通常使用"当前话题"即可满足大多数需求。
3. **设置数据键**：为要存储的数据指定一个清晰、有意义的名称，便于日后识别。
    1. 例如：`user_preference`、`last_order_id`等。
    2. 如需使用变量作为键名，可点击"@"按钮选择现有变量。
4. **填写数据值**：输入需要存储的具体内容。
    1. 可以是固定文本，如`"已完成订单"`。
    2. 也可以引用变量，如`@user_response`。
5. **设置过期时间**（可选）：根据数据的使用场景设置合适的过期时间。
    1. 临时数据可设置较短时间，如`3600`（1小时）。
    2. 长期使用的数据可留空（永不过期）或设置较长时间。
### 进阶技巧
1. **动态键名设计**：
    1. 可以使用变量组合生成动态键名，如`user_@user_id`，这样可以为不同用户创建专属的数据条目。
    2. 使用有规律的键名前缀，如`temp_data_1`、`temp_data_2`，便于批量管理相关数据。
2. **数据组织优化**：
    1. 对于复杂数据，可以考虑使用JSON格式存储，如`{"name": "张三", "age": 28}`。
    2. 使用前缀区分不同业务数据，如`order_xxx`和`user_xxx`。
## 注意事项
### 数据键命名规范
1. **避免特殊字符**：键名应尽量使用字母、数字和下划线，避免特殊字符可能引起的解析问题。
2. **保持唯一性**：在相同作用域内，不同数据应使用不同的键名，否则新值会覆盖旧值。
3. **命名有意义**：使用能反映数据内容的键名，提高代码可读性，如`user_age`比`u_a`更直观。
### 数据存储限制
1. **数据大小限制**：单个数据项大小应控制在合理范围内（通常建议不超过10MB）。
2. **存储容量考虑**：持久化存储有总容量限制，请合理规划使用，及时清理不需要的数据。
3. **敏感信息处理**：避免存储用户隐私等敏感信息，如必须存储，请确保加密处理。
## 常见问题
### 保存的数据找不到了怎么办？
**回答**：可能的原因有：
- 数据键名拼写错误：检查数据加载时使用的键名是否与存储时完全一致。
- 作用域选择不同：确保加载数据时选择了与存储时相同的作用域。
- 数据已过期：检查存储时设置的过期时间是否已到。
- 数据被其他流程覆盖：同名键会被新值覆盖，检查是否有其他流程使用了相同的键名。
### 如何高效管理多个相关数据？
**回答**：推荐以下方法：
- 使用命名前缀：如所有与用户相关的数据键以"user_"开头。
- 采用JSON格式：将相关数据组织成JSON对象一起存储，而不是分散存储。
- 设置合理的过期时间：临时数据设置较短的过期时间，自动清理不再需要的数据。
## 常见搭配节点
|**节点类型**|**搭配原因**|
|---|---|
|条件分支节点|根据数据加载结果判断是否存在特定数据，选择不同处理路径。|
|大模型调用节点|使用存储的上下文信息，提供更连贯的对话体验。|